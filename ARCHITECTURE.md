# æŠ•èµ„ä¼°å€¼ç³»ç»Ÿ - æ¶æ„è®¾è®¡æ–‡æ¡£

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

- **ä¸“ä¸šæ€§**ï¼šæä¾›ç¬¦åˆæŠ•èµ„æœºæ„æ ‡å‡†çš„ä¼°å€¼æ–¹æ³•
- **å®Œæ•´æ€§**ï¼šè¦†ç›–ç›¸å¯¹ä¼°å€¼ã€ç»å¯¹ä¼°å€¼ã€æƒ…æ™¯åˆ†æã€å‹åŠ›æµ‹è¯•å…¨æµç¨‹
- **å¯æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ·»åŠ æ–°çš„ä¼°å€¼æ–¹æ³•
- **æ˜“ç”¨æ€§**ï¼šæä¾›APIã€å‘½ä»¤è¡Œã€å‰ç«¯å¤šç§ä½¿ç”¨æ–¹å¼

### 1.2 æŠ€æœ¯é€‰å‹

| å±‚çº§ | æŠ€æœ¯é€‰æ‹© | ç†ç”± |
|------|---------|------|
| åç«¯æ¡†æ¶ | FastAPI | é«˜æ€§èƒ½ã€è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆã€ç±»å‹éªŒè¯ |
| æ•°æ®å¤„ç† | NumPy + Pandas | æ•°å€¼è®¡ç®—é«˜æ•ˆã€æ•°æ®å¤„ç†ä¾¿æ· |
| æ•°æ®æº | Tushare | Aè‚¡æ•°æ®æƒå¨ã€æ¥å£ç¨³å®š |
| å‰ç«¯æ¡†æ¶ | Vue.js 3 | ç»„ä»¶åŒ–ã€ç”Ÿæ€å®Œå–„ã€å­¦ä¹ æ›²çº¿å¹³ç¼“ |
| å›¾è¡¨åº“ | ECharts | åŠŸèƒ½å¼ºå¤§ã€ä¸­æ–‡å‹å¥½ã€å®šåˆ¶æ€§å¼º |

---

## 2. é¡¹ç›®ç›®å½•ç»“æ„

### 2.1 æ•´ä½“ç»“æ„

```
investment_valuation/
â”œâ”€â”€ backend/                    # åç«¯ä»£ç ï¼ˆæ–°ç»“æ„ï¼‰
â”‚   â”œâ”€â”€ core/                  # æ ¸å¿ƒæ¨¡å‹å’Œæ•°æ®åº“
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ models.py          # é¢†åŸŸæ¨¡å‹ï¼ˆCompany, ValuationResultç­‰ï¼‰
â”‚   â”‚   â””â”€â”€ database.py        # æ•°æ®åº“ç®¡ç†ï¼ˆSQLAlchemyï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ services/              # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ absolute_valuation.py      # DCFç»å¯¹ä¼°å€¼
â”‚   â”‚   â”œâ”€â”€ relative_valuation.py      # ç›¸å¯¹ä¼°å€¼ï¼ˆP/E, P/S, P/Bç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ multi_product_valuation.py # å¤šäº§å“ä¼°å€¼
â”‚   â”‚   â”œâ”€â”€ scenario_analysis.py       # æƒ…æ™¯åˆ†æ
â”‚   â”‚   â”œâ”€â”€ sensitivity_analysis.py    # æ•æ„Ÿæ€§åˆ†æ
â”‚   â”‚   â”œâ”€â”€ stress_test.py             # å‹åŠ›æµ‹è¯•
â”‚   â”‚   â””â”€â”€ valuation_engine.py        # ä¼°å€¼å¼•æ“
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                   # APIæ¥å£å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py            # FastAPIä¸»å…¥å£
â”‚   â”‚   â”œâ”€â”€ schemas.py         # Pydanticæ¨¡å‹
â”‚   â”‚   â””â”€â”€ routes/            # è·¯ç”±æ¨¡å—
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ valuation.py   # ä¼°å€¼ç›¸å…³è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ scenario.py    # æƒ…æ™¯åˆ†æè·¯ç”±
â”‚   â”‚       â”œâ”€â”€ stress_test.py # å‹åŠ›æµ‹è¯•è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ sensitivity.py # æ•æ„Ÿæ€§åˆ†æè·¯ç”±
â”‚   â”‚       â”œâ”€â”€ data.py        # æ•°æ®è·å–è·¯ç”±
â”‚   â”‚       â””â”€â”€ history.py     # å†å²è®°å½•è·¯ç”±
â”‚   â”‚
â”‚   â”œâ”€â”€ data/                  # æ•°æ®è·å–
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ fetcher.py         # Tushareæ•°æ®è·å–
â”‚   â”‚
â”‚   â””â”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ other_methods.py   # å…¶ä»–ä¼°å€¼æ–¹æ³•ï¼ˆVCæ³•ç­‰ï¼‰
â”‚
â”œâ”€â”€ frontend-vue/              # Vue.jså‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ views/             # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ services/          # APIæœåŠ¡
â”‚   â”‚   â””â”€â”€ assets/            # é™æ€èµ„æº
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ docs/                      # æ–‡æ¡£
â”œâ”€â”€ api.py                     # æ—§ç‰ˆAPIï¼ˆå¾…è¿ç§»ï¼‰
â”œâ”€â”€ examples.py                # ç¤ºä¾‹ä»£ç 
â”œâ”€â”€ requirements.txt           # Pythonä¾èµ–
â””â”€â”€ README.md                  # é¡¹ç›®è¯´æ˜
```

### 2.2 æ¨¡å—è¯´æ˜

#### 2.2.1 æ ¸å¿ƒå±‚ (core/)

| æ–‡ä»¶ | åŠŸèƒ½ | ä¸»è¦ç±» |
|------|------|--------|
| models.py | é¢†åŸŸæ¨¡å‹å®šä¹‰ | Company, Comparable, ValuationResult, ScenarioConfig, ProductSegment |
| database.py | æ•°æ®åº“ç®¡ç† | DatabaseManager, ValuationHistory |

#### 2.2.2 æœåŠ¡å±‚ (services/)

| æ–‡ä»¶ | åŠŸèƒ½ | ä¸»è¦ç±» |
|------|------|--------|
| absolute_valuation.py | DCFç»å¯¹ä¼°å€¼ | AbsoluteValuation |
| relative_valuation.py | ç›¸å¯¹ä¼°å€¼ | RelativeValuation |
| multi_product_valuation.py | å¤šäº§å“ä¼°å€¼ | MultiProductValuation |
| scenario_analysis.py | æƒ…æ™¯åˆ†æ | ScenarioAnalyzer |
| sensitivity_analysis.py | æ•æ„Ÿæ€§åˆ†æ | SensitivityAnalyzer |
| stress_test.py | å‹åŠ›æµ‹è¯• | StressTester |
| valuation_engine.py | ä¼°å€¼å¼•æ“ | ValuationEngine |

#### 2.2.3 APIå±‚ (api/)

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| main.py | FastAPIåº”ç”¨å…¥å£ |
| schemas.py | è¯·æ±‚/å“åº”æ¨¡å‹ |
| routes/*.py | å„åŠŸèƒ½æ¨¡å—çš„è·¯ç”±å¤„ç† |

#### 2.2.4 æ•°æ®å±‚ (data/)

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| fetcher.py | Tushareæ•°æ®è·å– |

---

## 3. æ¶æ„è®¾è®¡

### 3.1 åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        è¡¨ç°å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Vue.js SPA  â”‚  â”‚  APIæ–‡æ¡£     â”‚  â”‚  å‘½ä»¤è¡Œå·¥å…·  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        APIç½‘å…³å±‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              FastAPI Application                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚   è·¯ç”±     â”‚  â”‚  æ•°æ®éªŒè¯  â”‚  â”‚   CORS     â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä¸šåŠ¡é€»è¾‘å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ä¼°å€¼å¼•æ“    â”‚  é£é™©åˆ†æ    â”‚  æ•°æ®è·å–    â”‚  å·¥å…·   â”‚ â”‚
â”‚  â”‚              â”‚              â”‚              â”‚         â”‚ â”‚
â”‚  â”‚ - ç›¸å¯¹ä¼°å€¼   â”‚ - æƒ…æ™¯åˆ†æ   â”‚ - Tushare    â”‚ - æŠ¥å‘Š  â”‚ â”‚
â”‚  â”‚ - ç»å¯¹ä¼°å€¼   â”‚ - å‹åŠ›æµ‹è¯•   â”‚   API        â”‚ - æ—¥å¿—  â”‚ â”‚
â”‚  â”‚ - å¤šäº§å“     â”‚ - æ•æ„Ÿæ€§     â”‚              â”‚         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        é¢†åŸŸæ¨¡å‹å±‚                            â”‚
â”‚  Company, Comparable, ValuationResult, ScenarioConfig, ... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™

#### 3.2.1 å•ä¸€èŒè´£åŸåˆ™
æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªä¼°å€¼æ–¹æ³•æˆ–åŠŸèƒ½åŸŸï¼š
- `services/relative_valuation.py`ï¼šåªå¤„ç†ç›¸å¯¹ä¼°å€¼é€»è¾‘
- `services/absolute_valuation.py`ï¼šåªå¤„ç†DCFä¼°å€¼
- `services/scenario_analysis.py`ï¼šåªå¤„ç†æƒ…æ™¯åˆ†æ

#### 3.2.2 ä¾èµ–å€’ç½®åŸåˆ™
ä¸šåŠ¡é€»è¾‘å±‚ä¾èµ–äºæŠ½è±¡çš„æ¨¡å‹æ¥å£ï¼Œè€Œéå…·ä½“å®ç°

#### 3.2.3 å¼€é—­åŸåˆ™
ç³»ç»Ÿå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼š
- æ·»åŠ æ–°ä¼°å€¼æ–¹æ³•æ—¶ï¼Œåªéœ€æ–°å¢æ¨¡å—
- é€šè¿‡ç»§æ‰¿å’Œç»„åˆå®ç°åŠŸèƒ½æ‰©å±•

---

## 4. æ•°æ®æµè®¾è®¡

### 4.1 ä¼°å€¼æµç¨‹

```
ç”¨æˆ·è¾“å…¥ (Vueå‰ç«¯)
    â”‚
    â–¼
API éªŒè¯ (Pydantic Schema)
    â”‚
    â–¼
æœåŠ¡å±‚å¤„ç† (ValuationService)
    â”‚
    â–¼
é¢†åŸŸæ¨¡å‹ (Company, ValuationResult)
    â”‚
    â–¼
æ•°æ®åº“æŒä¹…åŒ– (SQLAlchemy)
    â”‚
    â–¼
è¿”å›ç»“æœç»™å‰ç«¯
```

### 4.2 å†å²è®°å½•ä¿å­˜

```
å®Œæ•´ä¼°å€¼ç»“æœ
    â”‚
    â”œâ”€ DCFç»“æœ
    â”œâ”€ ç›¸å¯¹ä¼°å€¼ç»“æœ
    â”œâ”€ æƒ…æ™¯åˆ†æç»“æœ
    â”œâ”€ å‹åŠ›æµ‹è¯•ç»“æœ
    â””â”€ æ•æ„Ÿæ€§åˆ†æç»“æœ
        â”‚
        â–¼
JSONåºåˆ—åŒ–åˆ° notes å­—æ®µ
        â”‚
        â–¼
ValuationHistory è¡¨
```

---

## 5. APIè®¾è®¡

### 5.1 ä¼°å€¼ç›¸å…³API

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| /api/valuation/absolute | POST | DCFç»å¯¹ä¼°å€¼ |
| /api/valuation/relative | POST | ç›¸å¯¹ä¼°å€¼ |
| /api/valuation/multi-product-dcf | POST | å¤šäº§å“DCFä¼°å€¼ |
| /api/valuation/compare | POST | å¤šæ–¹æ³•å¯¹æ¯”ä¼°å€¼ |

### 5.2 åˆ†æAPI

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| /api/scenario/analyze | POST | æƒ…æ™¯åˆ†æ |
| /api/stress-test/full | POST | ç»¼åˆå‹åŠ›æµ‹è¯• |
| /api/sensitivity/comprehensive | POST | ç»¼åˆæ•æ„Ÿæ€§åˆ†æ |

### 5.3 æ•°æ®API

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| /api/data/tushare/configure | POST | é…ç½®Tushare Token |
| /api/data/comparable/{industry} | GET | è·å–å¯æ¯”å…¬å¸ |
| /api/data/stock/{ts_code} | GET | è·å–è‚¡ç¥¨æ•°æ® |

### 5.4 å†å²è®°å½•API

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| /api/history | GET | è·å–å†å²è®°å½•åˆ—è¡¨ |
| /api/history/{id} | GET | è·å–å•æ¡å†å²è®°å½• |
| /api/history/save | POST | ä¿å­˜å†å²è®°å½• |

---

## 6. è¿ç§»æŒ‡å—

### 6.1 ä»æ—§ç»“æ„è¿ç§»

å½“å‰é¡¹ç›®æ­£åœ¨è¿›è¡Œç»“æ„é‡æ„ã€‚æ—§çš„æ–‡ä»¶ä½äºæ ¹ç›®å½•ï¼Œæ–°çš„ç»“æ„ä½äº `backend/` ç›®å½•ã€‚

**è¿ç§»çŠ¶æ€**ï¼š
- âœ… æ ¸å¿ƒæ¨¡å‹å·²ç§»è‡³ `backend/core/`
- âœ… ä¸šåŠ¡æœåŠ¡å·²ç§»è‡³ `backend/services/`
- âœ… æ•°æ®è·å–å·²ç§»è‡³ `backend/data/`
- ğŸ”„ APIå±‚è¿ç§»ä¸­ï¼ˆæš‚æ—¶ä½¿ç”¨æ ¹ç›®å½•çš„ `api.py`ï¼‰

### 6.2 Importè·¯å¾„æ›´æ–°

**æ—§è·¯å¾„** â†’ **æ–°è·¯å¾„**ï¼š
```python
# æ—§
from models import Company
from database import DatabaseManager
from relative_valuation import RelativeValuation

# æ–°
from core.models import Company
from core.database import DatabaseManager
from services.relative_valuation import RelativeValuation
```

---

## 7. éƒ¨ç½²è¯´æ˜

### 7.1 æœ¬åœ°å¼€å‘

```bash
# åç«¯
cd /path/to/investment_valuation
python api.py

# å‰ç«¯
cd frontend-vue
npm run dev
```

### 7.2 ç”Ÿäº§éƒ¨ç½²

```bash
# ä½¿ç”¨ gunicorn + uvicorn
gunicorn api:app \
    --workers 4 \
    --worker-class uvicorn.workers.UvicornWorker \
    --bind 0.0.0.0:8000
```
